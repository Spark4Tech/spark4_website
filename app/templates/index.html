{% extends "base.html" %}

{% block content %}
<!-- Hero Section -->
<section id="hero" class="relative h-screen flex items-center justify-center overflow-hidden bg-gradient-to-br from-black via-gray-900 to-gray-800">
    <!-- Video Background -->
    <video 
        autoplay 
        loop 
        muted 
        playsinline
        preload="auto"
        class="absolute inset-0 w-full h-full object-cover opacity-50"
    >
        <!-- <source src="{{ url_for('static', filename='videos/hero_video.mp4') }}" type="video/mp4" -->
        <!-- Fallback if video doesn't load -->
        <img 
            src="{{ url_for('static', filename='images/fallback_image.png') }}" 
            alt="Background Fallback"
            class="absolute inset-0 w-full h-full object-cover opacity-50"
        >
    </video>
    
    <!-- Content -->
    <div class="relative z-10 text-center text-white max-w-4xl px-4 sm:px-12">
        <h1 class="text-4xl sm:text-5xl lg:text-7xl xl:text-7xl font-bold mb-12 text-transparent bg-clip-text bg-gradient-to-r from-blue-500 to-blue-300 leading-tight">
            Igniting Digital<br>Transformation
        </h1>
        <p class="text-2xl mt-8 mb-12 text-gray-200 max-w-3xl mx-auto">
            Technology-fueled solutions that drive innovation and growth
        </p>
        <a href="#contact" class="inline-block bg-[#cce0ff] text-blue-900 px-8 py-4 rounded-full font-semibold shadow-lg hover:bg-[#b3d1ff] transition-all duration-300 transform hover:-translate-y-1 hover:shadow-xl">
            Talk to Us
        </a>
    </div>
</section>

<!-- What We Do Section -->
<section id="about" class="py-20 bg-black">
    <div class="container mx-auto px-4">
        <div class="max-w-4xl mx-auto">
            <h2 class="text-4xl font-bold mb-12 text-center text-transparent bg-clip-text bg-gradient-to-r from-blue-500 to-blue-300">Who We Are</h2>
            <p class="text-xl mb-12 leading-relaxed text-gray-300 text-center">
                We can help you take advantage the latest technology to grow your business and make it more successful. Whether it is a new website, on online store, or a custom application for your customers, we'll work together with you to unlock your business's full potential.
            </p>
        </div>
    </div>
</section>

<!-- Services Section -->
<section id="services" class="py-24 bg-gray-900">
    <div class="container mx-auto px-5">
        <div class="text-center">
            <h2 class="text-4xl font-bold text-center text-transparent bg-clip-text bg-gradient-to-r from-blue-500 to-blue-300 mb-4">Our Services</h2>
            <p class="text-gray-400 max-w-2xl mx-auto mb-12">
                Tailored digital solutions that transform your business through a modern digital presence, custom applications, and end-to-end support.
            </p>
        </div>
        
        <div class="grid mt-16 grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
        
        <!-- Digital Presence Card -->
        <div class="service-card flex flex-col bg-gray-800 p-8 rounded-xl border border-gray-700 hover:border-blue-800 transition-all duration-300 group">
            <div class="flex justify-center">
                <div class="icon-container mb-6 bg-blue-900/20 p-4 rounded-xl inline-flex items-center justify-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 text-blue-500 group-hover:text-blue-400 transition-colors" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 10a1 1 0 011-1h4a1 1 0 011 1v4a1 1 0 01-1 1h-4a1 1 0 01-1-1v-4z" />
                    </svg>
                </div>
            </div>
            <h3 class="text-2xl font-semibold mb-4 text-blue-400 text-center group-hover:text-blue-300 transition-colors">Digital Presence</h3>
            <p class="text-gray-300 mb-6">Build and enhance your digital footprint with strategic websites and marketing that resonate with your target audience.</p>
            
            <div class="mt-auto text-center">
                <button 
                    hx-get="{{ url_for('main.service_details', service_id='digital-presence') }}"
                    hx-target="#modal-service-content"
                    hx-swap="innerHTML"
                    hx-indicator="#loading-indicator"
                    class="toggle-details inline-block bg-gradient-to-r from-red-900 to-red-700 text-white px-4 py-2 rounded-lg hover:from-red-950 hover:to-red-800 transition-all duration-300">
                    Learn More
                </button>
            </div>
            
            <!-- Service details container -->
            <div id="service-details-digital-presence" class="service-details w-full mt-6 pt-6 border-t border-gray-700 hidden" 
                 data-service-id="digital-presence"
                 style="border-top-width: 0px;" 
                 hx-on:htmx:after-swap="
                   if (this.innerHTML.trim()) { 
                     this.classList.remove('hidden'); 
                     this.style.borderTopWidth = '1px';
                   } else { 
                     this.classList.add('hidden');
                     this.style.borderTopWidth = '0px';
                   }
                 ">
            </div>
        </div>

        <!-- Custom Applications Card -->
        <div class="service-card flex flex-col bg-gray-800 p-8 rounded-xl border border-gray-700 hover:border-blue-800 transition-all duration-300 group">
            <div class="flex justify-center">
                <div class="icon-container mb-6 bg-blue-900/20 p-4 rounded-xl inline-flex items-center justify-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 text-blue-500 group-hover:text-blue-400 transition-colors" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z" />
                    </svg>
                </div>
            </div>
            <h3 class="text-2xl font-semibold mb-4 text-blue-400 text-center group-hover:text-blue-300 transition-colors">Custom Applications</h3>
            <p class="text-gray-300 mb-6">Develop tailored applications that solve unique business challenges and unlock opportunities for your team and for your customers.</p>
            
            <div class="mt-auto text-center">
                <button 
                    hx-get="{{ url_for('main.service_details', service_id='custom-applications') }}"
                    hx-target="#modal-service-content"
                    hx-swap="innerHTML"
                    hx-indicator="#loading-indicator"
                    class="toggle-details inline-block bg-gradient-to-r from-red-900 to-red-700 text-white px-4 py-2 rounded-lg hover:from-red-950 hover:to-red-800 transition-all duration-300">
                    Learn More
                </button>
            </div>
            
            <!-- Service details container -->
            <div id="service-details-custom-applications" class="service-details w-full mt-6 pt-6 border-t border-gray-700 hidden" 
                 data-service-id="custom-applications"
                 style="border-top-width: 0px;" 
                 hx-on:htmx:after-swap="
                   if (this.innerHTML.trim()) { 
                     this.classList.remove('hidden'); 
                     this.style.borderTopWidth = '1px';
                   } else { 
                     this.classList.add('hidden');
                     this.style.borderTopWidth = '0px';
                   }
                 ">
            </div>
        </div>

        <!-- Business Operations Card -->
        <div class="service-card flex flex-col bg-gray-800 p-8 rounded-xl border border-gray-700 hover:border-blue-800 transition-all duration-300 group">
            <div class="flex justify-center">
                <div class="icon-container mb-6 bg-blue-900/20 p-4 rounded-xl inline-flex items-center justify-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 text-blue-500 group-hover:text-blue-400 transition-colors" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 3v2m6-2v2M9 19v2m6-2v2M5 9H3m2 6H3m18-6h-2m2 6h-2M7 19h10a2 2 0 002-2V7a2 2 0 00-2-2H7a2 2 0 00-2 2v10a2 2 0 002 2zM9 9h6v6H9V9z" />
                    </svg>
                </div>
            </div>
            <h3 class="text-2xl font-semibold mb-4 text-blue-400 text-center group-hover:text-blue-300 transition-colors">Business Operations</h3>
            <p class="text-gray-300 mb-6">Support users, optimize workflows, and enable continuous iterative innovation.</p>
            
            <div class="mt-auto text-center">
                <button 
                    hx-get="{{ url_for('main.service_details', service_id='business-operations') }}"
                    hx-target="#modal-service-content"
                    hx-swap="innerHTML"
                    hx-indicator="#loading-indicator"
                    class="toggle-details inline-block bg-gradient-to-r from-red-900 to-red-700 text-white px-4 py-2 rounded-lg hover:from-red-950 hover:to-red-800 transition-all duration-300">
                    Learn More
                </button>
            </div>
            
            <!-- Service details container -->
            <div id="service-details-business-operations" class="service-details w-full mt-6 pt-6 border-t border-gray-700 hidden" 
                 data-service-id="business-operations"
                 style="border-top-width: 0px;" 
                 hx-on:htmx:after-swap="
                   if (this.innerHTML.trim()) { 
                     this.classList.remove('hidden'); 
                     this.style.borderTopWidth = '1px';
                   } else { 
                     this.classList.add('hidden');
                     this.style.borderTopWidth = '0px';
                   }
                 ">
            </div>
        </div>
        </div>
    </div>
</section>

<div id="loading-indicator" class="htmx-indicator fixed top-4 right-4 bg-blue-500 text-white px-4 py-2 rounded-lg shadow-lg">
    Loading...
</div>

<!-- Projects Section -->
<section id="projects" class="py-24 bg-black">
    <div class="container mx-auto px-4">
        <h2 class="text-4xl font-bold mb-16 text-center text-white">Recent Projects</h2>
        <div class="grid grid-cols-1 mt-8 md:grid-cols-3 gap-8 max-w-5xl mx-auto">
            <!-- Haypoint Fermentation -->
            <div class="bg-gray-800 rounded-xl overflow-hidden border border-gray-700 hover:border-blue-500 transition-all duration-300">
                <a href="https://haypointfermentation.com" target="_blank">
                    <img src="{{ url_for('static', filename='images/haypoint.png') }}" alt="Haypoint Fermentation: Custom Fermentation Process Tracking Platform" 
                    loading="lazy" class="w-full h-64 object-cover">
                </a>
                <div class="p-6">
                    <h3 class="text-2xl font-semibold mb-2 text-blue-400">Haypoint Fermentation</h3>
                    <p class="text-gray-300">Custom web platform for a regional fermentation producer; integrated AI support for content management</p>
                </div>
            </div>

            <!-- Wellness Corner -->
            <div class="bg-gray-800 rounded-xl overflow-hidden border border-gray-700 hover:border-blue-500 transition-all duration-300">
                <a href="https://well.voice4equity.com" target="_blank">
                    <img src="{{ url_for('static', filename='images/wellness_corner.png') }}" alt="Wellness Corner" class="w-full h-64 object-cover">
                </a>
                <div class="p-6">
                    <h3 class="text-2xl font-semibold mb-2 text-blue-400">Wellness Corner</h3>
                    <p class="text-gray-300">Mobile application for personalized wellness planning designed for women; integrated AI for schedule customization</p>
                </div>
            </div>

            <!-- Leaders Platform -->
            <div class="bg-gray-800 rounded-xl overflow-hidden border border-gray-700 hover:border-blue-500 transition-all duration-300">
                <a href="https://voice4equity.com/services" target="_blank">
                    <img src="{{ url_for('static', filename='images/leaders.png') }}" alt="Leaders Platform" class="w-full h-64 object-cover">
                </a>
                <div class="p-6">
                    <h3 class="text-2xl font-semibold mb-2 text-blue-400">Leaders Platform</h3>
                    <p class="text-gray-300">Data platform for management of education policy and data analytics for US public school districts</p>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Process Section -->
<section id="process" class="py-20 bg-gray-900">
    <div class="container mx-auto px-4">
        <h2 class="text-4xl font-bold mb-16 text-center text-transparent bg-clip-text bg-gradient-to-r from-blue-500 to-blue-300">Our Process</h2>
        <div class="flex flex-col md:flex-row justify-between items-stretch gap-8">
            <!-- Step 1 -->
            <div class="flex-1 text-center group p-6 border border-white/20 rounded-lg hover:border-white/40 transition-colors">
                <div class="bg-gradient-to-r from-red-900 to-red-700 text-white rounded-full h-16 w-16 flex items-center justify-center mx-auto mb-4 text-2xl font-bold transform group-hover:-translate-y-2 transition-transform duration-300">1</div>
                <h3 class="text-xl font-semibold mb-4 text-blue-400 group-hover:text-blue-300 transition-colors">Discovery & Assessment</h3>
                <p class="text-gray-300 group-hover:text-gray-200 transition-colors">Understand your business challenges, opportunities, and goals</p>
            </div>
            
            <!-- Step 2 -->
            <div class="flex-1 text-center group p-6 border border-white/20 rounded-lg hover:border-white/40 transition-colors">
                <div class="bg-gradient-to-r from-red-900 to-red-700 text-white rounded-full h-16 w-16 flex items-center justify-center mx-auto mb-4 text-2xl font-bold transform group-hover:-translate-y-2 transition-transform duration-300">2</div>
                <h3 class="text-xl font-semibold mb-4 text-blue-400 group-hover:text-blue-300 transition-colors">Planning & Design</h3>
                <p class="text-gray-300 group-hover:text-gray-200 transition-colors">Develop a tailored roadmap and spec aligned with your business objectives</p>
            </div>
            
            <!-- Step 3 -->
            <div class="flex-1 text-center group p-6 border border-white/20 rounded-lg hover:border-white/40 transition-colors">
                <div class="bg-gradient-to-r from-red-900 to-red-700 text-white rounded-full h-16 w-16 flex items-center justify-center mx-auto mb-4 text-2xl font-bold transform group-hover:-translate-y-2 transition-transform duration-300">3</div>
                <h3 class="text-xl font-semibold mb-4 text-blue-400 group-hover:text-blue-300 transition-colors">Build & Launch</h3>
                <p class="text-gray-300 group-hover:text-gray-200 transition-colors">Deploy solutions, integrate tools, and optimize processes</p>
            </div>
            
            <!-- Step 4 -->
            <div class="flex-1 text-center group p-6 border border-white/20 rounded-lg hover:border-white/40 transition-colors">
                <div class="bg-gradient-to-r from-red-900 to-red-700 text-white rounded-full h-16 w-16 flex items-center justify-center mx-auto mb-4 text-2xl font-bold transform group-hover:-translate-y-2 transition-transform duration-300">4</div>
                <h3 class="text-xl font-semibold mb-4 text-blue-400 group-hover:text-blue-300 transition-colors">Sustain & Grow</h3>
                <p class="text-gray-300 group-hover:text-gray-200 transition-colors">Learn, support end-users, plan enhancements, analyze data</p>
            </div>
        </div>
    </div>
</section>

<!-- Why Choose Us Section -->
<section id="why-us" class="py-20 bg-black">
    <div class="container mx-auto px-4">
        <h2 class="text-4xl font-bold mb-16 text-center text-white">Why Choose Spark4</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-8 max-w-4xl mx-auto">
            <!-- Reason 1 -->
            <div class="bg-gray-800 p-8 rounded-xl border border-gray-700 hover:border-blue-500 transition-all duration-300">
                <h3 class="text-xl font-semibold mb-4 text-blue-400">We get to know your business</h3>
                <p class="text-gray-300">We learn about you and your business so we can align with your long-term business objectives and understand what really matters.</p>
            </div>
            <!-- Reason 2 -->
            <div class="bg-gray-800 p-8 rounded-xl border border-gray-700 hover:border-blue-500 transition-all duration-300">
                <h3 class="text-xl font-semibold mb-4 text-blue-400">We move fast</h3>
                <p class="text-gray-300">We use agile processes and AI to design and build quickly, reducing your time-to-value.</p>
            </div>
            
            <!-- Reason 3 -->
            <div class="bg-gray-800 p-8 rounded-xl border border-gray-700 hover:border-blue-500 transition-all duration-300">
                <h3 class="text-xl font-semibold mb-4 text-blue-400">We tailor for every client</h3>
                <p class="text-gray-300">Every business is unique, and one-size-fits-all approaches do not work when it comes to your brand and online presence. We will design a unique solution just for you.</p>
            </div>
            
            <!-- Reason 4 -->
            <div class="bg-gray-800 p-8 rounded-xl border border-gray-700 hover:border-blue-500 transition-all duration-300">
                <h3 class="text-xl font-semibold mb-4 text-blue-400">Modern technology stack</h3>
                <p class="text-gray-300">We leverage the latest tools and open-source frameworks, ensuring your solutions are built on solid technologies that work, are fast, and are cost efficient. You get a lifetime license for the software code for any custom solution, website, or application that you purchase.</p>
            </div>
        </div>
    </div>
</section>

<!-- Who We Work With Section -->
<section id="partners" class="py-16 bg-gray-800">
    <div class="container mx-auto px-4">
        <h2 class="text-3xl font-bold mt-8 mb-12 text-center text-white">Our Solution Partners</h2>
        
        <!-- Flex layout with wrapping for mobile -->
        <div class="flex flex-wrap justify-center items-center gap-8 md:gap-10 lg:gap-12">
            <a href="https://www.digitalocean.com" 
               target="_blank" 
               rel="noopener noreferrer"
               class="block transform hover:scale-110 transition-transform duration-300">
                <img src="{{ url_for('static', filename='images/logos/do.png') }}" 
                     alt="DigitalOcean: Cloud Infrastructure Partner" 
                     class="h-16 md:h-20 lg:h-24 grayscale hover:grayscale-0 opacity-70 hover:opacity-100 transition-all duration-300">
            </a>
            
            <a href="https://cloud.google.com" 
               target="_blank" 
               rel="noopener noreferrer"
               class="block transform hover:scale-110 transition-transform duration-300">
                <img src="{{ url_for('static', filename='images/logos/google.png') }}" 
                     alt="Google Cloud: Cloud Computing and AI Technologies" 
                     class="h-16 md:h-20 lg:h-24 grayscale hover:grayscale-0 opacity-70 hover:opacity-100 transition-all duration-300">
            </a>
            
            <a href="https://www.anthropic.com" 
               target="_blank" 
               rel="noopener noreferrer"
               class="block transform hover:scale-110 transition-transform duration-300">
                <img src="{{ url_for('static', filename='images/logos/anthropic.png') }}" 
                     alt="Anthropic: Advanced AI Research" 
                     class="h-16 md:h-20 lg:h-24 grayscale hover:grayscale-0 opacity-70 hover:opacity-100 transition-all duration-300">
            </a>
            
            <a href="https://aws.amazon.com" 
               target="_blank" 
               rel="noopener noreferrer"
               class="block transform hover:scale-110 transition-transform duration-300">
                <img src="{{ url_for('static', filename='images/logos/aws.png') }}" 
                     alt="Amazon Web Services: Cloud Computing" 
                     class="h-16 md:h-20 lg:h-24 grayscale hover:grayscale-0 opacity-70 hover:opacity-100 transition-all duration-300">
            </a>
            
            <a href="https://www.openai.com" 
               target="_blank" 
               rel="noopener noreferrer"
               class="block transform hover:scale-110 transition-transform duration-300">
                <img src="{{ url_for('static', filename='images/logos/openai.png') }}" 
                     alt="OpenAI: Pioneering Artificial Intelligence" 
                     class="h-16 md:h-20 lg:h-24 grayscale hover:grayscale-0 opacity-70 hover:opacity-100 transition-all duration-300">
            </a>
            
            <a href="https://huggingface.co" 
               target="_blank" 
               rel="noopener noreferrer"
               class="block transform hover:scale-110 transition-transform duration-300">
                <img src="{{ url_for('static', filename='images/logos/huggingface.png') }}" 
                     alt="Hugging Face: Machine Learning and NLP" 
                     class="h-16 md:h-20 lg:h-24 grayscale hover:grayscale-0 opacity-70 hover:opacity-100 transition-all duration-300">
            </a>
        </div>
    </div>
</section>

<!-- Apps Section -->
<section id="apps" class="py-20 bg-gray-900">
    <div class="container mx-auto px-4">
        <h2 class="text-4xl font-bold mb-16 text-center text-white">Featured Apps</h2>
        <div class="flex justify-center">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 max-w-4xl">                
                <!-- Stash It App -->
                <div class="bg-gray-800 p-8 rounded-xl border border-gray-700 hover:border-blue-500 transition-all duration-300">
                    <div class="flex items-center mb-4">
                        <h3 class="text-2xl font-semibold text-blue-400 mr-4">Stash It</h3>
                        <span class="bg-blue-500 text-white text-xs px-2 py-1 rounded">New</span>
                    </div>
                    <p class="text-gray-300 mb-4">
                        A Chrome extension that helps you manage your digital workflow by creating calendar reminders for web pages and documents.
                    </p>
                    <div class="flex space-x-4">
                        <a href="{{ url_for('main.stash_it') }}" class="bg-gradient-to-r from-blue-500 to-purple-500 text-white px-4 py-2 rounded-lg hover:from-blue-600 hover:to-purple-600 transition duration-200">
                            Learn More
                        </a>
                        <a href="https://chromewebstore.google.com/detail/stash-it/mggedkhlkcpjjdhmnckfolhphhgdgijp" target="_blank" class="border border-blue-400 text-blue-400 px-4 py-2 rounded-lg hover:bg-blue-500 hover:text-white transition duration-200">
                            Install
                        </a>
                    </div>
                </div>

                <!-- Sparkal App -->
                <div class="bg-gray-800 p-8 rounded-xl border border-gray-700 hover:border-blue-500 transition-all duration-300">
                    <div class="flex items-center mb-4">
                        <h3 class="text-2xl font-semibold text-blue-400 mr-4">Sparkal</h3>
                        <span class="bg-green-500 text-white text-xs px-2 py-1 rounded">Beta</span>
                    </div>
                    <p class="text-gray-300 mb-4">
                        A micro-learning platform designed for content creators to transform long-form content into bite-sized, actionable insights.
                    </p>
                    <div class="flex space-x-4">
                        <a href="#" class="bg-gradient-to-r from-blue-500 to-purple-500 text-white px-4 py-2 rounded-lg hover:from-blue-600 hover:to-purple-600 transition duration-200">
                            Coming Soon
                        </a>
                        <a href="#contact" class="border border-blue-400 text-blue-400 px-4 py-2 rounded-lg hover:bg-blue-500 hover:text-white transition duration-200">
                            Join Waitlist
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Contact Section -->
<section id="contact" class="py-20 bg-black">
    <div class="container mx-auto px-4">
        <!-- Wrap both the heading and form in a target div -->
        <div id="contact-content">
            <div id="contact-heading">
                <h2 class="text-4xl font-bold mb-12 text-center text-white">Let's Talk</h2>
            </div>
            <div id="contact-form" class="max-w-xl mx-auto">
                <form 
                    hx-post="{{ url_for('main.contact') }}"
                    hx-trigger="submit"
                    hx-target="#contact-content"
                    hx-indicator="#spinnerOverlay"
                    hx-swap="outerHTML"
                    hx-headers='{"X-CSRFToken": "{{ form.csrf_token._value() }}"}'
                    class="space-y-6"
                    x-data
                    @submit.prevent
                >
                    {{ form.csrf_token }}
                    
                    <div>
                        <label for="name" class="block text-lg mb-2 text-gray-300">Name</label>
                        {{ form.name(class="w-full bg-gray-800 border border-gray-700 rounded-lg px-4 py-2 text-white focus:border-blue-500 focus:outline-none", placeholder="Your name") }}
                    </div>
                    
                    <div>
                        <label for="email" class="block text-lg mb-2 text-gray-300">Email</label>
                        {{ form.email(class="w-full bg-gray-800 border border-gray-700 rounded-lg px-4 py-2 text-white focus:border-blue-500 focus:outline-none", placeholder="your@email.com") }}
                    </div>
                    
                    <div>
                        <label for="message" class="block text-lg mb-2 text-gray-300">How can we help you grow your business?</label>
                        {{ form.message(class="w-full bg-gray-800 border border-gray-700 rounded-lg px-4 py-2 text-white focus:border-blue-500 focus:outline-none", rows="5", placeholder="Tell us about your business needs...") }}
                    </div>
                    
                    {{ form.submit(class="w-full bg-gradient-to-r from-blue-900 to-blue-700 text-white px-6 py-3 rounded-lg font-semibold hover:from-blue-950 hover:to-blue-800 transition-all duration-300 transform hover:-translate-y-1 hover:shadow-xl") }}
                </form>
            </div>
        </div>
    </div>
</section>

<!-- Service Details Modal -->
<div id="service-details-modal" class="service-details-modal">
    <div class="modal-content">
        <button id="modal-close" class="modal-close">&times;</button>
        <div id="modal-service-content">
            <!-- Content will be loaded here via HTMX -->
        </div>
    </div>
</div>

<script>
    // Modal close function - Defined BEFORE we use it in event listeners
    window.closeModal = function() {
        const modal = document.getElementById('service-details-modal');
        modal.classList.remove('active');
        document.body.style.overflow = '';
        
        // Clear the modal content when closing
        document.getElementById('modal-service-content').innerHTML = '';

        // If there's an active HTMX request, abort it
        htmx.trigger('#modal-service-content', 'htmx:abort');
    }

    // Function to adjust the grid layout when a card is expanded
    function adjustGridLayout() {
        const cards = document.querySelectorAll('.service-card');
        const expandedCard = document.querySelector('.service-card.expanded');
        
        if (!expandedCard) return;
        
        // Reset all margins first
        cards.forEach(card => {
            card.style.marginTop = '';
        });
        
        // Get the index of the expanded card
        const cardArray = Array.from(cards);
        const expandedIndex = cardArray.indexOf(expandedCard);
        
        // Calculate and apply margins based on viewport width
        if (window.innerWidth >= 1024) { // lg breakpoint for 3 columns
            const rowPosition = expandedIndex % 3;
            if (rowPosition === 0 || rowPosition === 1) {
                const nextRowStart = Math.ceil((expandedIndex + 1) / 3) * 3;
                for (let i = nextRowStart; i < cards.length && i < nextRowStart + 3; i++) {
                    if (cardArray[i]) {
                        const height = expandedCard.querySelector('.service-details').offsetHeight;
                        cardArray[i].style.marginTop = `${height}px`;
                    }
                }
            }
        } else if (window.innerWidth >= 768) { // md breakpoint for 2 columns
            const rowPosition = expandedIndex % 2;
            if (rowPosition === 0) {
                const nextRowStart = Math.ceil((expandedIndex + 1) / 2) * 2;
                for (let i = nextRowStart; i < cards.length && i < nextRowStart + 2; i++) {
                    if (cardArray[i]) {
                        const height = expandedCard.querySelector('.service-details').offsetHeight;
                        cardArray[i].style.marginTop = `${height}px`;
                    }
                }
            }
        }
    }

    document.getElementById('modal-service-content').addEventListener('click', function(e) {
            if (e.target.matches('[hx-on\\:click="closeModal()"]') || 
                e.target.matches('[\\@click="closeModal()"]')) {
                closeModal();
            }
        });

    // Simple debounce function since we don't have lodash
    function debounce(func, wait) {
        let timeout;
        return function executedFunction(...args) {
            const later = () => {
                clearTimeout(timeout);
                func(...args);
            };
            clearTimeout(timeout);
            timeout = setTimeout(later, wait);
        };
    }

    // Initialize all event handlers when DOM is loaded
    document.addEventListener('DOMContentLoaded', function() {
        // Spinner events for HTMX
        document.body.addEventListener('htmx:beforeRequest', function(evt) {
            showSpinner();
        });
        
        document.body.addEventListener('htmx:afterRequest', function(evt) {
            hideSpinner();
        });
        
        document.body.addEventListener('htmx:error', function(evt) {
            console.error('HTMX error:', evt);
            hideSpinner();
            showToast('An error occurred. Please try again.', false);
        });

        // Listen for the custom event from HX-Trigger
        document.body.addEventListener('showSuccessToast', function() {
            hideSpinner();
            showToast('Thank you! We will be in touch soon.', true);
        });
        
        // Handle form submission errors
        document.body.addEventListener('htmx:responseError', function() {
            hideSpinner();
            showToast('Please check your inputs and try again.', false);
        });
        
        // Modal handling for service details
        document.querySelectorAll('.toggle-details').forEach(button => {
            button.addEventListener('click', function() {
                // Show the modal
                const modal = document.getElementById('service-details-modal');
                modal.classList.add('active');
                
                // Prevent scrolling on the body
                document.body.style.overflow = 'hidden';
            });
        });

        // Modal close handlers
        const modalCloseButton = document.getElementById('modal-close');
        if (modalCloseButton) {
            modalCloseButton.addEventListener('click', closeModal);
        }

        const modalElement = document.getElementById('service-details-modal');
        if (modalElement) {
            modalElement.addEventListener('click', function(e) {
                if (e.target === this) {
                    closeModal();
                }
            });
        }

        // Escape key handler
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape' && document.getElementById('service-details-modal').classList.contains('active')) {
                closeModal();
            }
        });

        // HTMX event handlers
        document.body.addEventListener('htmx:afterSwap', function(evt) {
            if (evt.detail.target.id === 'modal-service-content') {
                // Add click handlers to any close buttons in the modal content
                const closeButtons = evt.detail.target.querySelectorAll('[onclick="closeModal()"]');
                closeButtons.forEach(button => {
                    button.onclick = function(e) {
                        e.preventDefault();
                        closeModal();
                        return false;
                    };
                });
                
                // Ensure modal is visible after content loads
                document.getElementById('service-details-modal').classList.add('active');
            }
        });

        document.body.addEventListener('htmx:beforeSwap', function(evt) {
            if (evt.detail.target.id === 'modal-service-content') {
                // Remove 'hidden' class if it exists
                evt.detail.target.classList.remove('hidden');
            }
        });
    });

    // Add resize listener for grid layout adjustments with our own debounce
    window.addEventListener('resize', debounce(adjustGridLayout, 250));
</script>
{% endblock %}
